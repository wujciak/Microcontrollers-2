;
; Autor: Jakub Wójciak
; Lista 1 
; Zadanie 3
;

.cseg
rjmp start
.org 0x46

start:
	ldi r16, low(ramend)
	out spl, r16
	ldi r16, high(ramend)
	out sph, r16

	ldi r16, 0x00
	out ddrb, r16

	ldi r16, 0xff
	out ddrc, r16
	out portc, r16

	ldi r16, 0xff
	ldi r19, 0x00

main_loop:
    in r17, pinb	;stan bieżący do pinb
    call delay		;odczekaj około 49ms
	mov r18, r17	;zapisuje stan przycisku do porownania
    in r17, pinb	;stan bieżący do pinb
    cp r18, r17		;porównanie stanu poprzedniego i bieżącego
    breq check

	rjmp main_loop

check:
    cpi r17, 0b11110111	;sprawdź przycisk 3
    breq button_3

    cpi r17, 0b01111111	;sprawdź przycisk 7
    breq button_7 

    rjmp main_loop

button_3:	;zwiększ licznik
	inc r19
	eor r19, r16
    out portc, r19
	eor r19, r16
    rjmp main_loop

button_7:	;zmniejsz licznik
	dec r19
	eor r19, r16
    out portc, r19
	eor r19, r16
    rjmp main_loop

delay:
    ldi r23, 0xFF
delay_loop:
	ldi r22, 0xff
delay_loop2:
	ldi r21, 0x03
delay_loop3:
    dec r21
    brne delay_loop3
	dec r22
	brne delay_loop2
	dec r23
	brne delay_loop
    ret

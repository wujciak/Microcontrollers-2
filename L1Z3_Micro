;
; Autor: Jakub Wójciak
; Lista 1 
; Zadanie 3
;

.cseg
rjmp start
.org 0x46

start:
	ldi r16, low(ramend)
	out spl, r16
	ldi r16, high(ramend)
	out sph, r16

	ldi r16, 0x00
	out ddrb, r16

	ldi r16, 0xff
	out ddrc, r16
	out portc, r16

	ldi r16, 0xff

main_loop:
    in r16, pinb	;stan bieżący do pinb
    mov r20, r16	;zapisuje stan przycisku do porownania

stability_loop:
    call delay		;odczekaj około 49ms
    in r16, pinb	;stan bieżący do pinb
    cp r20, r16		;porównanie stanu poprzedniego i bieżącego
    brne stability_loop

    cpi r16, 0b11110111	;sprawdź przycisk 3
    breq button_3

    cpi r16, 0b01111111	;sprawdź przycisk 7
    breq button_7 

    rjmp main_loop

button_3:
	sec
    rol r19 	;zwiększ licznik
    out portc, r19
    rjmp main_loop

button_7:
	clc
    ror r19		;zmniejsz licznik
    out portc, r19
    rjmp main_loop

delay:
    ldi r21, 0xFF
delay_loop:
	ldi r18, 0xff
delay_loop2:
	ldi r17, 0x03
delay_loop3:
    dec r17
    brne delay_loop3
	dec r18
	brne delay_loop2
	dec r21
	brne delay_loop
    ret
